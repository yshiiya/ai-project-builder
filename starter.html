<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Project ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼</title>
    <script>
        // Redirect to prompt-generator.html with project-plan mode
        window.location.replace('prompt-generator.html?mode=project-plan');
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @media (min-width: 768px) {
            .container {
                max-width: 1200px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Fallback content in case redirect fails -->
    <div class="min-h-screen flex items-center justify-center">
        <div class="text-center p-8">
            <h1 class="text-2xl font-bold mb-4">ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆä¸­...</h1>
            <p class="text-gray-600 mb-4">è‡ªå‹•çš„ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ã«ç§»å‹•ã—ã¾ã™ã€‚</p>
            <p class="text-gray-600">ç§»å‹•ã—ãªã„å ´åˆã¯ã€<a href="prompt-generator.html?mode=project-start" class="text-blue-600 hover:underline">ã“ã¡ã‚‰ã‚’ã‚¯ãƒªãƒƒã‚¯</a>ã—ã¦ãã ã•ã„ã€‚</p>
        </div>
    </div>
    
    <!-- Original content (hidden) -->
    <div style="display: none;">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold">ğŸš€ AI Project ã‚¹ã‚¿ãƒ¼ã‚¿ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼</h1>
                    <p class="text-sm opacity-90 mt-1">AIãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã™ã‚‹éš›ã®ã€æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç°¡å˜ã«ä½œæˆ</p>
                </div>
                <a href="index.html" class="px-4 py-2 bg-white text-blue-600 rounded-lg hover:bg-gray-100 transition-colors font-medium">
                    â† åŸºæœ¬æŒ‡ç¤ºãƒ“ãƒ«ãƒ€ãƒ¼ã¸
                </a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid md:grid-cols-2 gap-8">
            <!-- Left Column: Form -->
            <div class="space-y-6">
                <!-- Mode Toggle -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div id="basicInstructionsNotice" class="hidden mb-4 p-3 bg-green-100 border border-green-300 rounded-lg">
                        <p class="text-sm text-green-800 font-medium">âœ… åŸºæœ¬æŒ‡ç¤ºãƒ“ãƒ«ãƒ€ãƒ¼ã®è¨­å®šãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ</p>
                    </div>
                    <label class="flex items-center cursor-pointer">
                        <input type="checkbox" id="useBasicInstructions" class="mr-3 h-5 w-5" onchange="toggleMode()">
                        <div>
                            <span class="font-medium">åŸºæœ¬æŒ‡ç¤ºã®è¨­å®šã‚’ä½¿ç”¨</span>
                            <span class="text-sm text-gray-500 block">ï¼ˆåŸºæœ¬æŒ‡ç¤ºãƒ“ãƒ«ãƒ€ãƒ¼ã®è¨­å®šã‚’å¼•ãç¶™ãï¼‰</span>
                        </div>
                    </label>
                </div>

                <!-- Project Details -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">ğŸ“‹</span> ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå *</label>
                            <input type="text" id="projectName" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="ä¾‹: ECã‚µã‚¤ãƒˆã®ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç›®çš„ãƒ»ã‚´ãƒ¼ãƒ« *</label>
                            <textarea id="projectGoal" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-24"
                                      placeholder="ä¾‹: æ—¢å­˜ã®ECã‚µã‚¤ãƒˆã‚’ãƒ¢ãƒ€ãƒ³ãªæŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã§ãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã‚‹"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">æœŸé™ãƒ»ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³</label>
                            <input type="text" id="deadline" 
                                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                   placeholder="ä¾‹: 3ãƒ¶æœˆå¾Œã«ãƒ™ãƒ¼ã‚¿ç‰ˆãƒªãƒªãƒ¼ã‚¹">
                        </div>
                    </div>
                </div>

                <!-- Agent Tasks / Roles -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">ğŸ‘¥</span> <span id="rolesSectionTitle">ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ã‚¿ã‚¹ã‚¯</span>
                    </h3>
                    
                    <div id="agentTasksContainer" class="space-y-3">
                        <!-- Dynamically populated -->
                    </div>
                    
                    <div id="standaloneRolesContainer" class="hidden space-y-3">
                        <!-- Standalone roles -->
                    </div>
                    
                    <button id="addRoleBtn" onclick="addStandaloneRole()" 
                            class="hidden mt-4 w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-600 hover:border-gray-400 hover:text-gray-700 transition-colors">
                        + å½¹å‰²ã‚’è¿½åŠ 
                    </button>
                </div>

                <!-- Additional Information -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <span class="text-xl">ğŸ“</span> è¿½åŠ æƒ…å ±
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">æŠ€è¡“è¦ä»¶</label>
                            <textarea id="techRequirements" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-20"
                                      placeholder="ä¾‹: React, TypeScript, Next.js 14, Tailwind CSS"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">åˆ¶ç´„æ¡ä»¶</label>
                            <textarea id="constraints" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-20"
                                      placeholder="ä¾‹: æ—¢å­˜DBã¨ã®äº’æ›æ€§ç¶­æŒã€ç‰¹å®šã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä½¿ç”¨å¿…é ˆãªã©"></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">å‚è€ƒè³‡æ–™ãƒ»ãƒªãƒ³ã‚¯</label>
                            <textarea id="references" 
                                      class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 h-20"
                                      placeholder="ä¾‹: ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«: figma.com/..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4">
                    <button onclick="generatePrompt()" 
                            class="flex-1 px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-lg hover:from-pink-600 hover:to-purple-600 transition-all font-medium shadow-md">
                        ğŸš€ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆ
                    </button>
                    <button onclick="saveConfiguration()" 
                            class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium">
                        ğŸ’¾ ä¿å­˜
                    </button>
                    <button onclick="loadConfiguration()" 
                            class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all font-medium">
                        ğŸ“‚ èª­è¾¼
                    </button>
                </div>
            </div>

            <!-- Right Column: Preview -->
            <div class="sticky top-8">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg">ğŸ“„ ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</h3>
                        <button id="copyBtn" onclick="copyPrompt()" 
                                class="px-4 py-2 text-sm bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                                disabled>
                            ğŸ“‹ ã‚³ãƒ”ãƒ¼
                        </button>
                    </div>
                    
                    <div id="promptPreview" class="bg-gray-50 rounded-lg p-4 min-h-[400px] max-h-[600px] overflow-y-auto">
                        <p class="text-gray-500 text-center">ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€å·¦å´ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Configuration data
        let config = {
            useBasicInstructions: false,
            project: {
                name: '',
                goal: '',
                deadline: ''
            },
            agents: [],
            standaloneRoles: [],
            additional: {
                techRequirements: '',
                constraints: '',
                references: ''
            }
        };

        let standaloneRoleCounter = 0;

        // Load basic instructions from localStorage if available
        function loadBasicInstructions() {
            console.log('=== Loading Basic Instructions ===');
            console.log('Current origin:', window.location.origin);
            
            const savedData = localStorage.getItem('aiProjectBuilderData');
            console.log('Raw saved data exists:', savedData !== null);
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    console.log('Parsed data structure:', {
                        projectName: data.projectName,
                        multiAgent: data.multiAgent,
                        agentsCount: data.agents ? data.agents.length : 0,
                        agents: data.agents
                    });
                    
                    // åŸºæœ¬è¨­å®šã‚’èª­ã¿è¾¼ã‚€
                    // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ãƒ‡ãƒãƒƒã‚°
                    console.log('Full data structure:', data);
                    
                    // projectDetailsã‹ã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ç¢ºèª
                    const hasProjectName = data.projectDetails?.projectName || data.projectName;
                    const hasAgents = data.agents && data.agents.length > 0;
                    const isMultiAgent = data.multiAgent === true;
                    
                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°æƒ…å ±ã‚’ä¿å­˜
                    if (data.projectName || data.projectDescription || data.projectGoals || data.projectDeadline) {
                        window.basicProjectData = {
                            name: data.projectName || '',
                            description: data.projectDescription || '',
                            goals: data.projectGoals || '',
                            deadline: data.projectDeadline || ''
                        };
                        console.log('Project data saved:', window.basicProjectData);
                    }
                    
                    if (hasProjectName || hasAgents || data.role) {
                        console.log('Basic settings found, loading data...');
                        console.log('Multi-agent mode:', isMultiAgent);
                        
                        // ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                        if (isMultiAgent && hasAgents) {
                            config.agents = data.agents.map(agent => ({
                                icon: agent.icon || 'ğŸ‘¤',
                                name: agent.name || '',
                                role: agent.role || '',
                                specialties: agent.specialties || '',
                                task: ''
                            }));
                            console.log('Loaded multiple agents:', config.agents);
                        } 
                        // ã‚·ãƒ³ã‚°ãƒ«ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                        else if (!isMultiAgent && data.selectedAgent) {
                            // selectedAgentã®æƒ…å ±ã‚’1ã¤ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã—ã¦è¨­å®š
                            config.agents = [{
                                icon: data.selectedAgent.icon || 'ğŸ‘¤',
                                name: data.selectedAgent.name || '',
                                role: data.selectedAgent.role || '',
                                specialties: data.selectedAgent.specialties || '',
                                task: ''
                            }];
                            console.log('Loaded single agent:', config.agents);
                        }
                        // å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚ï¼ˆroleæƒ…å ±ãŒã‚ã‚‹å ´åˆï¼‰
                        else if (data.role) {
                            config.agents = [{
                                icon: 'ğŸ‘¤',
                                name: data.role,
                                role: data.role,
                                specialties: '',
                                task: ''
                            }];
                            console.log('Loaded agent from role field:', config.agents);
                        }
                        
                        return true;
                    } else {
                        console.log('No basic settings found');
                        console.log('Checked fields:', {
                            'data.projectDetails?.projectName': data.projectDetails?.projectName,
                            'data.projectName': data.projectName,
                            'data.agents': data.agents,
                            'data.role': data.role
                        });
                    }
                } catch (e) {
                    console.error('Failed to parse saved data:', e);
                    console.error('Saved data:', savedData);
                }
            } else {
                console.log('No saved data in localStorage');
                console.log('Available localStorage keys:', Object.keys(localStorage));
            }
            
            console.log('=== End Loading Basic Instructions ===');
            return false;
        }

        // Toggle between basic instructions and standalone mode
        function toggleMode() {
            const useBasic = document.getElementById('useBasicInstructions').checked;
            config.useBasicInstructions = useBasic;
            
            const agentContainer = document.getElementById('agentTasksContainer');
            const standaloneContainer = document.getElementById('standaloneRolesContainer');
            const addRoleBtn = document.getElementById('addRoleBtn');
            const sectionTitle = document.getElementById('rolesSectionTitle');
            
            if (useBasic) {
                // Check if agents are already loaded in config
                if (config.agents && config.agents.length > 0) {
                    console.log('Using already loaded agents:', config.agents);
                    agentContainer.classList.remove('hidden');
                    standaloneContainer.classList.add('hidden');
                    addRoleBtn.classList.add('hidden');
                    sectionTitle.textContent = 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ã‚¿ã‚¹ã‚¯';
                    renderAgentTasks();
                } else {
                    // Try to load if not already loaded
                    if (loadBasicInstructions()) {
                        agentContainer.classList.remove('hidden');
                        standaloneContainer.classList.add('hidden');
                        addRoleBtn.classList.add('hidden');
                        sectionTitle.textContent = 'ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåˆ¥ã‚¿ã‚¹ã‚¯';
                        renderAgentTasks();
                    } else {
                        alert('åŸºæœ¬æŒ‡ç¤ºãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…ˆã«åŸºæœ¬æŒ‡ç¤ºãƒ“ãƒ«ãƒ€ãƒ¼ã§ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                        document.getElementById('useBasicInstructions').checked = false;
                        config.useBasicInstructions = false;
                    }
                }
            } else {
                // Standalone mode
                agentContainer.classList.add('hidden');
                standaloneContainer.classList.remove('hidden');
                addRoleBtn.classList.remove('hidden');
                sectionTitle.textContent = 'å½¹å‰²ã¨ã‚¿ã‚¹ã‚¯';
                
                // Add initial role if none exist
                if (config.standaloneRoles.length === 0) {
                    addStandaloneRole();
                }
            }
        }

        // Render agent tasks for basic instructions mode
        function renderAgentTasks() {
            const container = document.getElementById('agentTasksContainer');
            container.innerHTML = config.agents.map((agent, index) => `
                <div class="p-4 bg-gray-50 rounded-lg">
                    <h5 class="font-medium text-gray-700 mb-2">${agent.icon} ${agent.name}</h5>
                    <p class="text-xs text-gray-500 mb-2">${agent.role}</p>
                    <textarea 
                        id="agentTask-${index}" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
                        placeholder="ã“ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ä¾é ¼ã™ã‚‹å…·ä½“çš„ãªã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›..."
                        onchange="updateAgentTask(${index}, this.value)"
                    >${agent.task || ''}</textarea>
                </div>
            `).join('');
        }

        // Update agent task
        function updateAgentTask(index, task) {
            if (config.agents[index]) {
                config.agents[index].task = task;
            }
        }

        // Add standalone role
        function addStandaloneRole() {
            const roleId = standaloneRoleCounter++;
            const role = {
                id: roleId,
                name: '',
                role: '',
                task: ''
            };
            
            config.standaloneRoles.push(role);
            
            const container = document.getElementById('standaloneRolesContainer');
            const roleDiv = document.createElement('div');
            roleDiv.id = `role-${roleId}`;
            roleDiv.className = 'p-4 bg-gray-50 rounded-lg relative';
            roleDiv.innerHTML = `
                <button onclick="removeStandaloneRole(${roleId})" 
                        class="absolute top-2 right-2 text-red-500 hover:text-red-700">
                    âœ•
                </button>
                <div class="space-y-3">
                    <input type="text" 
                           placeholder="å½¹å‰²åï¼ˆä¾‹: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºè€…ï¼‰" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
                           onchange="updateStandaloneRole(${roleId}, 'name', this.value)">
                    <input type="text" 
                           placeholder="å°‚é–€åˆ†é‡ï¼ˆä¾‹: React, TypeScript, UI/UXï¼‰" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
                           onchange="updateStandaloneRole(${roleId}, 'role', this.value)">
                    <textarea 
                           placeholder="æ‹…å½“ã‚¿ã‚¹ã‚¯" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm h-20"
                           onchange="updateStandaloneRole(${roleId}, 'task', this.value)"></textarea>
                </div>
            `;
            
            container.appendChild(roleDiv);
        }

        // Update standalone role
        function updateStandaloneRole(roleId, field, value) {
            const role = config.standaloneRoles.find(r => r.id === roleId);
            if (role) {
                role[field] = value;
            }
        }

        // Remove standalone role
        function removeStandaloneRole(roleId) {
            config.standaloneRoles = config.standaloneRoles.filter(r => r.id !== roleId);
            document.getElementById(`role-${roleId}`).remove();
        }

        // Generate prompt
        function generatePrompt() {
            // Update config with form values
            config.project.name = document.getElementById('projectName').value;
            config.project.goal = document.getElementById('projectGoal').value;
            config.project.deadline = document.getElementById('deadline').value;
            config.additional.techRequirements = document.getElementById('techRequirements').value;
            config.additional.constraints = document.getElementById('constraints').value;
            config.additional.references = document.getElementById('references').value;
            
            if (!config.project.name || !config.project.goal) {
                alert('ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¨ç›®çš„ã¯å¿…é ˆã§ã™ã€‚');
                return;
            }
            
            let prompt = `# ğŸš€ ${config.project.name} - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–‹å§‹\n\n`;
            prompt += `## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦\n`;
            prompt += `**ç›®çš„ãƒ»ã‚´ãƒ¼ãƒ«**: ${config.project.goal}\n`;
            if (config.project.deadline) {
                prompt += `**æœŸé™**: ${config.project.deadline}\n`;
            }
            prompt += `\n`;
            
            // Add roles and tasks
            if (config.useBasicInstructions && config.agents.length > 0) {
                prompt += `## ãƒãƒ¼ãƒ æ§‹æˆã¨ã‚¿ã‚¹ã‚¯å‰²ã‚Šå½“ã¦\n\n`;
                config.agents.forEach(agent => {
                    if (agent.task) {
                        prompt += `### ${agent.icon} ${agent.name}\n`;
                        prompt += `**å°‚é–€åˆ†é‡**: ${agent.role}\n`;
                        prompt += `**æ‹…å½“ã‚¿ã‚¹ã‚¯**: ${agent.task}\n\n`;
                    }
                });
            } else if (config.standaloneRoles.length > 0) {
                prompt += `## å¿…è¦ãªå½¹å‰²ã¨ã‚¿ã‚¹ã‚¯\n\n`;
                config.standaloneRoles.forEach(role => {
                    if (role.name && role.task) {
                        prompt += `### ${role.name}\n`;
                        if (role.role) {
                            prompt += `**å°‚é–€åˆ†é‡**: ${role.role}\n`;
                        }
                        prompt += `**æ‹…å½“ã‚¿ã‚¹ã‚¯**: ${role.task}\n\n`;
                    }
                });
            }
            
            // Add additional information
            if (config.additional.techRequirements || config.additional.constraints || config.additional.references) {
                prompt += `## è¿½åŠ æƒ…å ±\n\n`;
                if (config.additional.techRequirements) {
                    prompt += `**æŠ€è¡“è¦ä»¶**: ${config.additional.techRequirements}\n\n`;
                }
                if (config.additional.constraints) {
                    prompt += `**åˆ¶ç´„æ¡ä»¶**: ${config.additional.constraints}\n\n`;
                }
                if (config.additional.references) {
                    prompt += `**å‚è€ƒè³‡æ–™**: ${config.additional.references}\n\n`;
                }
            }
            
            prompt += `## é–‹å§‹æŒ‡ç¤º\n\n`;
            prompt += `ä¸Šè¨˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚å„æ‹…å½“è€…ã¯å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸã‚¿ã‚¹ã‚¯ã«åŸºã¥ã„ã¦ä½œæ¥­ã‚’é€²ã‚ã¦ãã ã•ã„ã€‚é€²æ—ã¯å®šæœŸçš„ã«å…±æœ‰ã—ã€å¿…è¦ã«å¿œã˜ã¦èª¿æ•´ã‚’è¡Œã„ã¾ã™ã€‚\n\n`;
            prompt += `ã¾ãšã¯å…¨ä½“ã®è¨ˆç”»ã¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã¤ã„ã¦æ¤œè¨ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚`;
            
            // Display prompt
            document.getElementById('promptPreview').innerHTML = `<pre class="whitespace-pre-wrap font-mono text-sm">${escapeHtml(prompt)}</pre>`;
            document.getElementById('copyBtn').disabled = false;
            
            // Save to session
            sessionStorage.setItem('generatedPrompt', prompt);
        }

        // Copy prompt to clipboard
        function copyPrompt() {
            const prompt = sessionStorage.getItem('generatedPrompt');
            if (prompt) {
                navigator.clipboard.writeText(prompt).then(() => {
                    const btn = document.getElementById('copyBtn');
                    const originalText = btn.textContent;
                    btn.textContent = 'âœ“ ã‚³ãƒ”ãƒ¼æ¸ˆã¿';
                    setTimeout(() => {
                        btn.textContent = originalText;
                    }, 2000);
                });
            }
        }

        // Save configuration
        function saveConfiguration() {
            // Update config with current form values
            config.project.name = document.getElementById('projectName').value;
            config.project.goal = document.getElementById('projectGoal').value;
            config.project.deadline = document.getElementById('deadline').value;
            config.additional.techRequirements = document.getElementById('techRequirements').value;
            config.additional.constraints = document.getElementById('constraints').value;
            config.additional.references = document.getElementById('references').value;
            
            localStorage.setItem('starterPromptConfig', JSON.stringify(config));
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // Load configuration
        function loadConfiguration() {
            const saved = localStorage.getItem('starterPromptConfig');
            if (saved) {
                try {
                    config = JSON.parse(saved);
                    
                    // Restore form values
                    document.getElementById('useBasicInstructions').checked = config.useBasicInstructions;
                    document.getElementById('projectName').value = config.project.name || '';
                    document.getElementById('projectGoal').value = config.project.goal || '';
                    document.getElementById('deadline').value = config.project.deadline || '';
                    document.getElementById('techRequirements').value = config.additional.techRequirements || '';
                    document.getElementById('constraints').value = config.additional.constraints || '';
                    document.getElementById('references').value = config.additional.references || '';
                    
                    // Restore roles/agents
                    toggleMode();
                    
                    alert('è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
                } catch (e) {
                    alert('è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                    console.error(e);
                }
            } else {
                alert('ä¿å­˜ã•ã‚ŒãŸè¨­å®šãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
            }
        }

        // Escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Check if coming from builder
            const urlParams = new URLSearchParams(window.location.search);
            const fromBuilder = urlParams.get('from') === 'builder';
            
            // Check if basic instructions are available
            const hasBasicInstructions = loadBasicInstructions();
            
            if (hasBasicInstructions || fromBuilder) {
                // åŸºæœ¬æŒ‡ç¤ºãŒå­˜åœ¨ã™ã‚‹å ´åˆã€ã¾ãŸã¯ãƒ“ãƒ«ãƒ€ãƒ¼ã‹ã‚‰æ¥ãŸå ´åˆã¯è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹
                document.getElementById('useBasicInstructions').checked = true;
                config.useBasicInstructions = true;
                
                if (hasBasicInstructions) {
                    // é€šçŸ¥ã‚’è¡¨ç¤º
                    document.getElementById('basicInstructionsNotice').classList.remove('hidden');
                    console.log('Basic instructions found, auto-checking the checkbox');
                    console.log('Loaded agents in initialization:', config.agents);
                    
                    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°æƒ…å ±ã‚’è‡ªå‹•å…¥åŠ›
                    if (window.basicProjectData) {
                        document.getElementById('projectName').value = window.basicProjectData.name || '';
                        document.getElementById('projectGoal').value = window.basicProjectData.goals || '';
                        document.getElementById('deadline').value = window.basicProjectData.deadline || '';
                        
                        // configã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã‚‚ä¿å­˜
                        config.project.name = window.basicProjectData.name || '';
                        config.project.goal = window.basicProjectData.goals || '';
                        config.project.deadline = window.basicProjectData.deadline || '';
                        
                        console.log('Project details auto-filled from basic instructions');
                    }
                }
            }
            
            toggleMode();
        });
    </script>
</body>
</html>